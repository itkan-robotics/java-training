{
  "title": "PathPlanner: Visual Autonomous Routines",
  "sections": [
    {
      "type": "text",
      "title": "What is PathPlanner?",
      "content": "PathPlanner is a motion profile generator and autonomous path planning tool for FRC robots. It allows you to draw paths on a field map, configure robot constraints (max velocity, acceleration), and automatically generate smooth trajectories. It integrates seamlessly with WPILib via `PathPlannerLib` to follow these paths in code.<br><br>The modern workflow uses <strong>AutoBuilder</strong>, which automatically generates commands to follow paths and trigger event markers (like \"Intake\" or \"Shoot\") defined in the GUI.<br><br>Learn more: <a href='https://pathplanner.dev/home.html' target='_blank'>PathPlanner Documentation</a>"
    },
    {
      "type": "text",
      "title": "Key Concepts",
      "content": "<strong>Path:</strong> A single trajectory from point A to point B, with waypoints and rotation targets.<br><strong>Auto:</strong> A full autonomous routine consisting of multiple paths and commands (e.g., \"Score -> Taxi -> Balance\").<br><strong>Event Markers:</strong> Triggers placed along a path that execute commands (like running an intake) when the robot reaches that point.<br><strong>Holonomic Mode:</strong> For swerve/mecanum drives, allows the robot to rotate independently of its movement direction.<br><strong>AutoBuilder:</strong> A utility that builds a full `Command` from a PathPlanner file, handling path following, event markers, and telemetry automatically."
    },
    {
      "type": "text",
      "title": "Configuring AutoBuilder",
      "content": "To use PathPlanner, you must configure `AutoBuilder` in your `RobotContainer` or `Drivetrain` subsystem. This tells PathPlanner how to control your robot and where it is."
    },
    {
      "type": "code",
      "title": "AutoBuilder Configuration (Swerve)",
      "content": "import com.pathplanner.lib.auto.AutoBuilder;\nimport com.pathplanner.lib.util.HolonomicPathFollowerConfig;\nimport com.pathplanner.lib.util.PIDConstants;\nimport com.pathplanner.lib.util.ReplanningConfig;\n\npublic class Drivetrain extends SubsystemBase {\n    public Drivetrain() {\n        // ... hardware init ...\n\n        AutoBuilder.configureHolonomic(\n                this::getPose,          // Supplier<Pose2d> function to supply current robot pose\n                this::resetPose,        // Consumer<Pose2d> function to reset the pose\n                this::getRobotRelativeSpeeds, // Supplier<ChassisSpeeds> current speeds\n                this::driveRobotRelative,     // Consumer<ChassisSpeeds> output for driving\n                new HolonomicPathFollowerConfig(\n                        new PIDConstants(5.0, 0.0, 0.0), // Translation PID constants\n                        new PIDConstants(5.0, 0.0, 0.0), // Rotation PID constants\n                        4.5,                             // Max module speed (m/s)\n                        0.4,                             // Drive base radius (m) (distance from center to furthest module)\n                        new ReplanningConfig()           // Default path replanning config\n                ),\n                () -> {\n                    // Boolean supplier that controls when the path will be mirrored for the red alliance\n                    // This will flip the path being followed to the red side of the field.\n                    // THE ORIGIN WILL REMAIN ON THE BLUE SIDE\n                    var alliance = DriverStation.getAlliance();\n                    if (alliance.isPresent()) {\n                        return alliance.get() == DriverStation.Alliance.Red;\n                    }\n                    return false;\n                },\n                this // Reference to this subsystem to set requirements\n        );\n    }\n}"
    },
    {
      "type": "text",
      "title": "Creating and Running Paths",
      "content": "Once configured, you can load paths or full autos by name. PathPlanner files are deployed to the robot's `deploy/pathplanner` directory."
    },
    {
      "type": "code",
      "title": "Loading Paths",
      "content": "// In RobotContainer.java\n\n// Build an auto command from a named \"Auto\" file in the GUI\nCommand myAuto = AutoBuilder.buildAuto(\"My Two Piece Auto\");\n\n// Or, follow a single path\nCommand followPath = AutoBuilder.followPath(PathPlannerPath.fromPathFile(\"Taxi Path\"));\n\n// Add to SmartDashboard chooser\nSendableChooser<Command> autoChooser = AutoBuilder.buildAutoChooser();\nSmartDashboard.putData(\"Auto Chooser\", autoChooser);"
    },
    {
      "type": "text",
      "title": "Event Markers and Named Commands",
      "content": "To use Event Markers, you must register your commands with `NamedCommands` <strong>before</strong> building the auto. This maps the string names in the PathPlanner GUI to actual Java commands."
    },
    {
      "type": "code",
      "title": "Registering Named Commands",
      "content": "import com.pathplanner.lib.auto.NamedCommands;\n\npublic class RobotContainer {\n    public RobotContainer() {\n        // Register Named Commands\n        NamedCommands.registerCommand(\"intake\", new IntakeCommand(m_intake));\n        NamedCommands.registerCommand(\"shoot\", new ShootCommand(m_shooter));\n        NamedCommands.registerCommand(\"stop\", Commands.runOnce(m_intake::stop));\n\n        // Now build the auto\n        autoChooser = AutoBuilder.buildAutoChooser();\n    }\n}"
    },
    {
      "type": "rules-box",
      "title": "PathPlanner Tips",
      "subtitle": "Best practices for success:",
      "items": [
        "Always measure your robot's max velocity and acceleration accurately.",
        "Tune PID constants in the HolonomicPathFollowerConfig; start low and increase.",
        "Use 'On-the-fly' generation for dynamic pathing if needed, but pre-generated paths are safer.",
        "Visualize path following in AdvantageScope or Field2d to debug tracking errors.",
        "Remember to register NamedCommands before building the auto chooser."
      ]
    },
    {
      "type": "link-grid",
      "title": "Related Topics",
      "links": [
        {
          "label": "PathPlanner Docs",
          "url": "https://pathplanner.dev/"
        },
        {
          "label": "Command-Based Programming",
          "id": "command-based-intro"
        },
        {
          "label": "Pose Estimation",
          "id": "pose-estimation-intro"
        }
      ]
    }
  ]
}