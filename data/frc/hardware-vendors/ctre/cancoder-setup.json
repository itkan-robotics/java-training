{
  "title": "CANcoder Setup and Basic Usage",
  "sections": [
    {
      "type": "text",
      "title": "Introduction to CANcoder",
      "content": "The CANcoder is CTRE's absolute encoder that provides precise position tracking over CAN bus. Unlike relative encoders (like those built into motors), absolute encoders remember their position even after power loss, making them ideal for mechanisms that need to know their position immediately on startup.<br><br>The CANcoder is commonly used for swerve module angle measurement, arm position tracking, and other mechanisms where absolute position is important. It provides high resolution (4096 counts per revolution) and communicates over CAN bus, eliminating the need for additional wiring."
    },
    {
      "type": "rules-box",
      "title": "CANcoder Features",
      "subtitle": "Key capabilities:",
      "items": [
        "Absolute position tracking (remembers position after power loss)",
        "High resolution (4096 counts per revolution)",
        "CAN bus communication (no extra wiring)",
        "Velocity measurement",
        "Magnet-based sensing (no mechanical contact)",
        "Configurable direction and offset",
        "Status LED for diagnostics"
      ]
    },
    {
      "type": "text",
      "title": "Hardware Setup",
      "content": "Before programming, you need to physically set up your CANcoder on the mechanism.<br><br><strong>Mounting CANcoder:</strong><br>1. Mount CANcoder securely to your mechanism<br>2. Ensure the magnet is properly aligned with the CANcoder<br>3. Magnet should be centered and at correct distance (see CANcoder documentation)<br>4. Secure all mounting hardware<br><br><strong>Wiring:</strong><br>1. <strong>CAN Bus:</strong> Connect CAN High and CAN Low to the CAN bus network<br>2. <strong>Power:</strong> CANcoder is powered from the CAN bus (no separate power needed)<br>3. <strong>Ground:</strong> Ensure proper CAN bus grounding<br><br><strong>Magnet Configuration:</strong><br>- Use the magnet provided with CANcoder<br>- Magnet should be mounted on rotating part of mechanism<br>- Maintain proper distance between magnet and CANcoder<br>- Ensure magnet is properly oriented"
    },
    {
      "type": "text",
      "title": "CAN ID Configuration",
      "content": "Each CANcoder needs a unique CAN ID (0-62) to communicate on the CAN bus. You can set the CAN ID using Phoenix Tuner or programmatically in code.<br><br><strong>Using Phoenix Tuner:</strong><br>1. Open Phoenix Tuner<br>2. Connect to your robot<br>3. Select the CANcoder device<br>4. Set the CAN ID in the configuration panel<br>5. Apply and save the configuration<br><br><strong>In Code:</strong> When you create a CANcoder instance, you specify the CAN ID in the constructor. The CAN ID must match what's configured in Phoenix Tuner.<br><br><strong>Best Practices:</strong><br>- Use sequential IDs for related devices<br>- Document your CAN ID assignments<br>- Keep CAN IDs organized by mechanism"
    },
    {
      "type": "code",
      "title": "Creating CANcoder Instances",
      "content": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.hardware.CANcoder;\n\npublic class SwerveModule {\n    // CANcoder for measuring module angle\n    private final CANcoder m_angleEncoder = new CANcoder(10);  // CAN ID 10\n    \n    public SwerveModule() {\n        // Configure CANcoder (see configuration section)\n        // For now, basic setup\n    }\n    \n    public double getAngle() {\n        // Read absolute position (in rotations)\n        return m_angleEncoder.getAbsolutePosition().getValue();\n    }\n}\n\n// Example: Multiple CANcoders\npublic class ArmSystem {\n    private final CANcoder m_shoulderEncoder = new CANcoder(11);  // CAN ID 11\n    private final CANcoder m_elbowEncoder = new CANcoder(12);     // CAN ID 12\n    \n    public double getShoulderAngle() {\n        return m_shoulderEncoder.getAbsolutePosition().getValue();\n    }\n    \n    public double getElbowAngle() {\n        return m_elbowEncoder.getAbsolutePosition().getValue();\n    }\n}"
    },
    {
      "type": "text",
      "title": "Reading Absolute Position",
      "content": "The CANcoder's primary function is providing absolute position. In Phoenix 6, position is returned in rotations (0.0 to 1.0 for one full revolution, or can be configured for 0-360 degrees).<br><br><strong>Position Range:</strong><br>- Position: 0.0 to 1.0 rotations (one full revolution)<br>- Can be converted to degrees: position * 360.0<br>- Position wraps around (1.0 + small increment = 0.0)<br><br><strong>Absolute vs Relative:</strong><br>- <strong>Absolute:</strong> Position is always known, even after power loss<br>- <strong>Relative:</strong> Position resets to 0 on power-up (like motor encoders)<br><br><strong>Reading Position:</strong> Use <code>getAbsolutePosition().getValue()</code> to read the current absolute position. This value is always available, even immediately after power-up. The value is returned as a <code>StatusSignal</code> which must be read using <code>getValue()</code>."
    },
    {
      "type": "code",
      "title": "Reading CANcoder Position",
      "content": "import com.ctre.phoenix6.hardware.CANcoder;\nimport com.ctre.phoenix6.BaseStatusSignal;\nimport edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;\n\npublic class CANcoderPosition {\n    private final CANcoder m_encoder = new CANcoder(10);\n    \n    // Status signal for efficient reading\n    private final BaseStatusSignal[] m_signals = {\n        m_encoder.getAbsolutePosition(),\n        m_encoder.getPosition()\n    };\n    \n    public void updatePosition() {\n        // Refresh all signals at once (efficient)\n        BaseStatusSignal.refreshAll(m_signals);\n        \n        // Read absolute position (0.0-1.0 rotations)\n        double rawPosition = m_encoder.getAbsolutePosition().getValue();\n        \n        // Convert to degrees (0-360)\n        double degrees = rawPosition * 360.0;\n        \n        // Alternative: Use getPosition() which may include offset\n        double positionWithOffset = m_encoder.getPosition().getValue();\n        \n        // Update dashboard\n        SmartDashboard.putNumber(\"CANcoder Raw Position (rotations)\", rawPosition);\n        SmartDashboard.putNumber(\"CANcoder Degrees\", degrees);\n        SmartDashboard.putNumber(\"CANcoder Position (with offset)\", positionWithOffset);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Reading Velocity",
      "content": "The CANcoder can also measure velocity (rate of rotation). This is useful for monitoring mechanism speed or for control applications.<br><br><strong>Velocity Units:</strong><br>- Velocity is returned in rotations per second<br>- Can be converted to degrees per second (multiply by 360.0)<br>- Positive = clockwise (typically), negative = counterclockwise<br><br><strong>Use Cases:</strong><br>- Monitoring mechanism speed<br>- Velocity-based control<br>- Detecting when mechanism is moving<br>- Diagnostic purposes<br><br><strong>Reading Velocity:</strong> Use <code>getVelocity().getValue()</code> to read the current velocity. The value is returned as a <code>StatusSignal</code> which must be read using <code>getValue()</code>. Velocity updates continuously as the mechanism rotates."
    },
    {
      "type": "code",
      "title": "Reading CANcoder Velocity",
      "content": "import com.ctre.phoenix6.hardware.CANcoder;\nimport com.ctre.phoenix6.BaseStatusSignal;\nimport edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;\n\npublic class CANcoderVelocity {\n    private final CANcoder m_encoder = new CANcoder(10);\n    \n    // Status signal for efficient reading\n    private final BaseStatusSignal[] m_signals = {\n        m_encoder.getVelocity()\n    };\n    \n    public void updateVelocity() {\n        // Refresh signal (efficient)\n        BaseStatusSignal.refreshAll(m_signals);\n        \n        // Read velocity (rotations per second)\n        double rawVelocity = m_encoder.getVelocity().getValue();\n        \n        // Convert to degrees per second\n        double degreesPerSecond = rawVelocity * 360.0;\n        \n        // Update dashboard\n        SmartDashboard.putNumber(\"CANcoder Velocity (RPS)\", rawVelocity);\n        SmartDashboard.putNumber(\"CANcoder Velocity (deg/s)\", degreesPerSecond);\n        \n        // Check if mechanism is moving\n        boolean isMoving = Math.abs(rawVelocity) > 0.1;  // Threshold in rotations/second\n        SmartDashboard.putBoolean(\"CANcoder Moving\", isMoving);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Initial Configuration",
      "content": "When setting up a CANcoder, there are several essential configuration parameters:<br><br><strong>Magnet Offset:</strong><br>- Calibrates the zero position<br>- Accounts for magnet mounting position<br>- Set during mechanism calibration<br><br><strong>Direction:</strong><br>- Inverts encoder direction if needed<br>- Set to match mechanism rotation direction<br><br><strong>Sensor Timeout:</strong><br>- Timeout for sensor reads<br>- Default is usually fine<br><br><strong>Status Frame Period:</strong><br>- Update rate for status information<br>- Lower = faster updates but more CAN bus usage<br>- Default is usually fine<br><br>These settings can be configured in Phoenix Tuner or in code. It's recommended to configure them in code for consistency."
    },
    {
      "type": "code",
      "title": "Basic CANcoder Configuration",
      "content": "import com.ctre.phoenix6.hardware.CANcoder;\nimport com.ctre.phoenix6.configs.CANcoderConfiguration;\nimport com.ctre.phoenix6.signals.SensorDirectionValue;\nimport com.ctre.phoenix6.signals.AbsoluteSensorRangeValue;\n\npublic class CANcoderConfig {\n    private final CANcoder m_encoder = new CANcoder(10);\n    \n    public CANcoderConfig() {\n        CANcoderConfiguration config = new CANcoderConfiguration();\n        \n        // Configure sensor direction (invert if needed)\n        config.MagnetSensor.SensorDirection = SensorDirectionValue.CounterClockwise_Positive;\n        \n        // Configure absolute sensor range\n        // 0 to 1.0 rotations (wraps around)\n        config.MagnetSensor.AbsoluteSensorRange = AbsoluteSensorRangeValue.Unsigned_0To1;\n        \n        // Configure magnet offset (calibrated value in rotations)\n        // This is set during mechanism calibration\n        double magnetOffset = 0.0;  // Calibrate this value\n        config.MagnetSensor.MagnetOffset = magnetOffset;\n        \n        // Apply configuration\n        m_encoder.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Using Phoenix Tuner for CANcoder",
      "content": "Phoenix Tuner can be used to configure and diagnose CANcoder devices. It's useful for initial setup and troubleshooting.<br><br><strong>Connecting to CANcoder:</strong><br>1. Open Phoenix Tuner and connect to robot<br>2. Ensure CANcoder is powered and on CAN bus<br>3. Phoenix Tuner will discover the CANcoder<br>4. Select CANcoder from device list<br><br><strong>Configuration:</strong><br>1. Navigate to CANcoder configuration panel<br>2. Configure parameters:<br>   - CAN ID<br>   - Magnet offset<br>   - Direction<br>   - Sensor range<br>3. Click \"Apply\" to save configuration<br><br><strong>Monitoring:</strong> Phoenix Tuner displays real-time CANcoder data:<br>- Absolute position<br>- Velocity<br>- Magnet strength<br>- Status information<br><br><strong>Calibration:</strong> Use Phoenix Tuner to help calibrate magnet offset by reading position and adjusting offset accordingly."
    },
    {
      "type": "text",
      "title": "Magnet Configuration",
      "content": "The CANcoder uses a magnet to sense position. Proper magnet configuration is critical for accurate readings.<br><br><strong>Magnet Requirements:</strong><br>- Use the magnet provided with CANcoder<br>- Magnet must be properly mounted on rotating part<br>- Maintain correct distance between magnet and CANcoder<br>- Ensure magnet is centered over sensor<br><br><strong>Magnet Strength:</strong><br>- CANcoder can report magnet strength<br>- Weak magnet = unreliable readings<br>- Strong magnet = good readings<br>- Check magnet strength in Phoenix Tuner<br><br><strong>Magnet Offset:</strong><br>- Accounts for physical mounting position<br>- Set during calibration<br>- Allows zero position to be anywhere on mechanism<br>- Configured in code or Phoenix Tuner"
    },
    {
      "type": "code",
      "title": "Checking Magnet Status",
      "content": "import com.ctre.phoenix6.hardware.CANcoder;\nimport com.ctre.phoenix6.BaseStatusSignal;\nimport edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;\n\npublic class MagnetStatus {\n    private final CANcoder m_encoder = new CANcoder(10);\n    \n    // Status signals for efficient reading\n    private final BaseStatusSignal[] m_signals = {\n        m_encoder.getMagnetFieldStrength()\n    };\n    \n    public void checkMagnet() {\n        // Refresh signal\n        BaseStatusSignal.refreshAll(m_signals);\n        \n        // Get magnet strength (0-100, higher is better)\n        double magnetStrength = m_encoder.getMagnetFieldStrength().getValue();\n        \n        // Check if magnet is detected\n        boolean magnetDetected = magnetStrength > 50;  // Threshold\n        \n        // Update dashboard\n        SmartDashboard.putNumber(\"CANcoder Magnet Strength\", magnetStrength);\n        SmartDashboard.putBoolean(\"CANcoder Magnet Detected\", magnetDetected);\n        \n        // Warning if magnet is weak\n        if (magnetStrength < 50) {\n            System.out.println(\"WARNING: CANcoder magnet strength is low: \" + magnetStrength);\n        }\n    }\n}"
    },
    {
      "type": "rules-box",
      "title": "Troubleshooting CANcoder Issues",
      "subtitle": "Common problems and solutions:",
      "items": [
        "<strong>Device Not Found:</strong> Check CAN ID, verify CAN bus wiring, ensure device is powered",
        "<strong>Incorrect Readings:</strong> Check magnet mounting, verify magnet strength, check magnet offset",
        "<strong>Position Jumps:</strong> Weak magnet, magnet too far from sensor, electrical interference",
        "<strong>Wrong Direction:</strong> Configure sensor direction, check magnet orientation",
        "<strong>No Reading:</strong> Check CAN bus connection, verify power, check status LED",
        "<strong>Inconsistent Readings:</strong> Check magnet mounting, verify distance, check for interference"
      ]
    },
    {
      "type": "rules-box",
      "title": "Best Practices for CANcoder Setup",
      "subtitle": "Tips for reliable operation:",
      "items": [
        "Mount CANcoder securely to prevent movement",
        "Ensure magnet is properly aligned and at correct distance",
        "Use proper CAN bus wiring with termination",
        "Configure in code for consistency",
        "Calibrate magnet offset during setup",
        "Test configuration thoroughly at multiple positions",
        "Document CAN ID assignments and calibration values",
        "Keep CAN bus wires away from power wires",
        "Protect from mechanical damage"
      ]
    },
    {
      "type": "link-grid",
      "title": "Related Topics",
      "links": [
        { "label": "CANcoder Absolute Encoders", "id": "cancoder-absolute-encoders" },
        { "label": "Talon FX Setup", "id": "talon-fx-setup" },
        { "label": "CTRE Introduction", "id": "ctre-intro" }
      ]
    }
  ]
}

