{
  "title": "Talon FX Configuration",
  "sections": [
    {
      "type": "text",
      "title": "Introduction to Talon FX Configuration",
      "content": "The Talon FX has many configurable parameters that control its behavior. Understanding and properly configuring these parameters is essential for optimal performance. Configuration can be done using Phoenix Tuner (graphical tool) or programmatically in code. This lesson covers all the important configuration options."
    },
    {
      "type": "text",
      "title": "Configuration Methods",
      "content": "There are two main ways to configure Talon FX parameters:<br><br><strong>Phoenix Tuner (Graphical):</strong><br>- Visual interface for configuring devices<br>- Good for initial setup and testing<br>- Configuration is saved to device's non-volatile memory<br>- Easy to see all parameters at once<br><br><strong>Code-Based Configuration:</strong><br>- Configure in your robot code<br>- Ensures consistent configuration across deployments<br>- Can be version controlled<br>- Recommended for production code<br><br><strong>Best Practice:</strong> Use Phoenix Tuner for initial setup and testing, but configure everything in code for your final robot program. This ensures your configuration is documented and consistent."
    },
    {
      "type": "rules-box",
      "title": "Essential Configuration Parameters",
      "subtitle": "Parameters you should always configure:",
      "items": [
        "<strong>Motor Inversion:</strong> Correct motor direction",
        "<strong>Neutral Mode:</strong> Brake or coast behavior when stopped",
        "<strong>Current Limits:</strong> Protect motor and battery",
        "<strong>Voltage Compensation:</strong> Consistent performance as battery drains",
        "<strong>Feedback Sensor:</strong> Which encoder to use (integrated or external)",
        "<strong>Sensor Phase:</strong> Match encoder direction to motor direction"
      ]
    },
    {
      "type": "text",
      "title": "Motor Inversion",
      "content": "Motor inversion determines whether positive power makes the motor spin forward or backward. This is important for ensuring your robot moves in the correct direction.<br><br><strong>When to Invert:</strong><br>- Motor spins backwards when given positive power<br>- Motors on opposite sides of drivetrain need opposite directions<br>- Mechanism needs to move in opposite direction<br><br><strong>Configuration:</strong> Configure inversion in the <code>TalonFXConfiguration</code> object or in Phoenix Tuner. Inversion can be set per-motor or can be handled by inverting the control signal."
    },
    {
      "type": "code",
      "title": "Configuring Motor Inversion",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.InvertedValue;\n\npublic class MotorInversion {\n    private final TalonFX m_leftMotor = new TalonFX(1);\n    private final TalonFX m_rightMotor = new TalonFX(2);\n    \n    public MotorInversion() {\n        // Left motor: normal direction\n        TalonFXConfiguration leftConfig = new TalonFXConfiguration();\n        leftConfig.MotorOutput.Inverted = InvertedValue.CounterClockwise_Positive;\n        m_leftMotor.getConfigurator().apply(leftConfig);\n        \n        // Right motor: inverted (spins opposite to left)\n        TalonFXConfiguration rightConfig = new TalonFXConfiguration();\n        rightConfig.MotorOutput.Inverted = InvertedValue.Clockwise_Positive;\n        m_rightMotor.getConfigurator().apply(rightConfig);\n        \n        // Alternative: Invert the control signal instead\n        // double leftPower = gamepad.getLeftY();\n        // double rightPower = -gamepad.getRightY();  // Inverted here\n    }\n}"
    },
    {
      "type": "text",
      "title": "Neutral Mode",
      "content": "Neutral mode determines what happens when the motor receives zero power (0.0).<br><br><strong>Brake Mode:</strong><br>- Motor actively resists rotation<br>- Useful for holding position<br>- Better for precision control<br>- Uses more power (motor is actively braking)<br><br><strong>Coast Mode:</strong><br>- Motor free-spins (no resistance)<br>- Useful for mechanisms that should move freely<br>- Less power consumption<br>- May drift when stopped<br><br><strong>When to Use Each:</strong><br>- <strong>Brake:</strong> Drivetrains, arms, elevators (where you want to hold position)<br>- <strong>Coast:</strong> Intakes, flywheels (where free-spinning is acceptable)"
    },
    {
      "type": "code",
      "title": "Configuring Neutral Mode",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.NeutralModeValue;\n\npublic class NeutralModeConfig {\n    private final TalonFX m_drivetrainMotor = new TalonFX(1);\n    private final TalonFX m_intakeMotor = new TalonFX(2);\n    \n    public NeutralModeConfig() {\n        // Drivetrain: brake mode (hold position)\n        TalonFXConfiguration drivetrainConfig = new TalonFXConfiguration();\n        drivetrainConfig.MotorOutput.NeutralMode = NeutralModeValue.Brake;\n        m_drivetrainMotor.getConfigurator().apply(drivetrainConfig);\n        \n        // Intake: coast mode (free-spin when stopped)\n        TalonFXConfiguration intakeConfig = new TalonFXConfiguration();\n        intakeConfig.MotorOutput.NeutralMode = NeutralModeValue.Coast;\n        m_intakeMotor.getConfigurator().apply(intakeConfig);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Current Limiting",
      "content": "Current limiting protects your motors and battery from damage due to excessive current draw. The Talon FX supports two types of current limiting (covered in detail in the current limiting lesson):<br><br><strong>Stator Current Limiting:</strong><br>- Protects the motor windings<br>- Limits current through the motor<br>- Prevents motor overheating<br><br><strong>Supply Current Limiting:</strong><br>- Protects the battery and Power Distribution Hub<br>- Limits current from the power source<br>- Prevents circuit breaker tripping<br><br><strong>Configuration:</strong> Set current limits based on your motor's specifications and mechanism requirements. Typical values range from 20-60 amps depending on the motor and application."
    },
    {
      "type": "code",
      "title": "Configuring Current Limits",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\n\npublic class CurrentLimitConfig {\n    private final TalonFX m_motor = new TalonFX(1);\n    \n    public CurrentLimitConfig() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Stator current limit (motor protection)\n        config.CurrentLimits.StatorCurrentLimitEnable = true;\n        config.CurrentLimits.StatorCurrentLimit = 40.0;  // Current limit (amps)\n        config.CurrentLimits.StatorCurrentLimitThreshold = 45.0;  // Trigger threshold (amps)\n        config.CurrentLimits.StatorCurrentLimitThresholdTime = 0.5;  // Trigger time (seconds)\n        \n        // Supply current limit (battery protection)\n        config.CurrentLimits.SupplyCurrentLimitEnable = true;\n        config.CurrentLimits.SupplyCurrentLimit = 40.0;  // Current limit (amps)\n        config.CurrentLimits.SupplyCurrentLimitThreshold = 45.0;  // Trigger threshold (amps)\n        config.CurrentLimits.SupplyCurrentLimitThresholdTime = 0.5;  // Trigger time (seconds)\n        \n        // Apply configuration\n        m_motor.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Voltage Compensation",
      "content": "As your robot battery drains during a match, the voltage decreases. This can cause inconsistent motor performance. Voltage compensation automatically adjusts motor output to maintain consistent performance regardless of battery voltage.<br><br><strong>How It Works:</strong><br>- You specify a nominal voltage (typically 12.0V)<br>- Talon FX measures actual battery voltage<br>- Motor output is scaled to compensate for voltage difference<br><br><strong>Benefits:</strong><br>- Consistent performance throughout match<br>- Predictable behavior<br>- Better autonomous repeatability<br><br><strong>When to Use:</strong> Enable voltage compensation for most applications, especially drivetrains and mechanisms where consistent performance is important."
    },
    {
      "type": "code",
      "title": "Configuring Voltage Compensation",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\n\npublic class VoltageCompensation {\n    private final TalonFX m_motor = new TalonFX(1);\n    \n    public VoltageCompensation() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Set peak forward and reverse voltages (nominal battery voltage)\n        config.Voltage.PeakForwardVoltage = 12.0;\n        config.Voltage.PeakReverseVoltage = -12.0;\n        \n        // Apply configuration\n        m_motor.getConfigurator().apply(config);\n        \n        // Now motor output will be automatically adjusted\n        // to maintain consistent performance as battery drains\n    }\n}"
    },
    {
      "type": "text",
      "title": "Feedback Sensor Configuration",
      "content": "The Talon FX can use different sensors for closed-loop control (PID, Motion Magic). You need to configure which sensor to use.<br><br><strong>Available Sensors:</strong><br>- <strong>Integrated Sensor:</strong> Built-in encoder on Talon FX (2048 counts/revolution)<br>- <strong>External Encoder:</strong> CANcoder or other external encoder<br>- <strong>Analog Sensor:</strong> Analog potentiometer or other analog sensor<br><br><strong>Configuration:</strong> Configure the feedback sensor in the <code>TalonFXConfiguration</code> object. The integrated sensor is the most common choice and requires no additional wiring."
    },
    {
      "type": "code",
      "title": "Configuring Feedback Sensor",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.FeedbackSensorSourceValue;\n\npublic class FeedbackSensorConfig {\n    private final TalonFX m_motor = new TalonFX(1);\n    \n    public FeedbackSensorConfig() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Configure integrated encoder as feedback sensor\n        config.Feedback.FeedbackSensorSource = FeedbackSensorSourceValue.RotorSensor;\n        \n        // Reset encoder position to zero\n        m_motor.setPosition(0);\n        \n        // Configure sensor phase (if encoder reads backwards)\n        // Set to true if encoder counts decrease when motor moves forward\n        config.Feedback.FeedbackRotorOffset = 0.0;  // Offset in rotations\n        config.Feedback.SensorToMechanismRatio = 1.0;  // Gear ratio\n        \n        // Apply configuration\n        m_motor.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Advanced Configuration Parameters",
      "content": "The Talon FX has many advanced configuration options for fine-tuning performance:<br><br><strong>Status Frame Periods:</strong><br>- Control how often status information is sent over CAN<br>- Reducing update rates can improve CAN bus performance<br>- Default rates are usually fine for most applications<br><br><strong>Closed Loop Settings:</strong><br>- Allowable closed loop error<br>- Closed loop peak output<br>- Integral accumulator limits<br><br><strong>Motion Profiling Parameters:</strong><br>- Cruise velocity<br>- Acceleration<br>- S-curve strength<br>- (Covered in Motion Magic lesson)<br><br><strong>Soft Limits:</strong><br>- Software-based position limits<br>- Prevents mechanism from moving beyond safe positions<br>- Useful for arms, elevators, etc."
    },
    {
      "type": "code",
      "title": "Advanced Configuration Example",
      "content": "import com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.FeedbackSensorSourceValue;\n\npublic class AdvancedConfig {\n    private final TalonFX m_motor = new TalonFX(1);\n    \n    public AdvancedConfig() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Configure feedback sensor\n        config.Feedback.FeedbackSensorSource = FeedbackSensorSourceValue.RotorSensor;\n        \n        // Configure soft limits (position limits in rotations)\n        config.SoftwareLimitSwitch.ForwardSoftLimitEnable = true;\n        config.SoftwareLimitSwitch.ForwardSoftLimitThreshold = 100.0;  // Max position (rotations)\n        \n        config.SoftwareLimitSwitch.ReverseSoftLimitEnable = true;\n        config.SoftwareLimitSwitch.ReverseSoftLimitThreshold = 0.0;  // Min position (rotations)\n        \n        // Configure closed loop settings (for PID control)\n        config.ClosedLoopRamps.VoltageClosedLoopRampPeriod = 0.5;  // Ramp time (seconds)\n        config.ClosedLoopRamps.TorqueClosedLoopRampPeriod = 0.5;\n        \n        // Apply configuration\n        m_motor.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Using Phoenix Tuner for Configuration",
      "content": "Phoenix Tuner provides a graphical interface for configuring Talon FX parameters. It's useful for initial setup and testing.<br><br><strong>Configuration Process:</strong><br>1. Open Phoenix Tuner and connect to robot<br>2. Select the Talon FX from device list<br>3. Navigate to configuration tabs:<br>   - <strong>General:</strong> CAN ID, motor inversion, neutral mode<br> - <strong>Current:</strong> Current limiting settings<br>   - <strong>Voltage:</strong> Voltage compensation<br>   - <strong>Sensor:</strong> Feedback sensor selection<br>   - <strong>Closed Loop:</strong> PID and closed loop settings<br>   - <strong>Motion Magic:</strong> Motion profiling parameters<br>4. Configure parameters as needed<br>5. Click \"Apply\" to save to device<br>6. Configuration is stored in device's non-volatile memory<br><br><strong>Saving/Loading Configs:</strong> Phoenix Tuner can save configuration files that can be loaded later or shared with team members."
    },
    {
      "type": "text",
      "title": "Code-Based Configuration",
      "content": "Configuring Talon FX in code ensures your configuration is documented, version-controlled, and consistent across deployments. This is the recommended approach for production code.<br><br><strong>Configuration Timing:</strong><br>- Configure devices in subsystem constructors<br>- Configure immediately after creating Talon FX instances<br>- Use configuration objects to set all parameters at once<br><br><strong>Configuration Methods:</strong><br>- Create a <code>TalonFXConfiguration</code> object<br>- Set all parameters in the configuration object<br>- Apply configuration using <code>getConfigurator().apply()</code><br>- Configuration is applied atomically<br><br><strong>Reading Configuration:</strong> You can read current configuration values using <code>getConfigurator().refresh()</code> and then access the configuration object, though this is less common than setting them."
    },
    {
      "type": "code",
      "title": "Complete Configuration Example",
      "content": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.InvertedValue;\nimport com.ctre.phoenix6.signals.NeutralModeValue;\nimport com.ctre.phoenix6.signals.FeedbackSensorSourceValue;\n\npublic class FullyConfiguredTalonFX {\n    private final TalonFX m_motor = new TalonFX(1);\n    \n    public FullyConfiguredTalonFX() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Basic settings\n        config.MotorOutput.Inverted = InvertedValue.CounterClockwise_Positive;\n        config.MotorOutput.NeutralMode = NeutralModeValue.Brake;\n        \n        // Current limiting\n        config.CurrentLimits.StatorCurrentLimitEnable = true;\n        config.CurrentLimits.StatorCurrentLimit = 40.0;\n        config.CurrentLimits.StatorCurrentLimitThreshold = 45.0;\n        config.CurrentLimits.StatorCurrentLimitThresholdTime = 0.5;\n        \n        config.CurrentLimits.SupplyCurrentLimitEnable = true;\n        config.CurrentLimits.SupplyCurrentLimit = 40.0;\n        config.CurrentLimits.SupplyCurrentLimitThreshold = 45.0;\n        config.CurrentLimits.SupplyCurrentLimitThresholdTime = 0.5;\n        \n        // Voltage compensation\n        config.Voltage.PeakForwardVoltage = 12.0;\n        config.Voltage.PeakReverseVoltage = -12.0;\n        \n        // Feedback sensor\n        config.Feedback.FeedbackSensorSource = FeedbackSensorSourceValue.RotorSensor;\n        config.Feedback.FeedbackRotorOffset = 0.0;\n        config.Feedback.SensorToMechanismRatio = 1.0;\n        \n        // Reset encoder position to zero\n        m_motor.setPosition(0);\n        \n        // Soft limits (optional)\n        config.SoftwareLimitSwitch.ForwardSoftLimitEnable = false;\n        config.SoftwareLimitSwitch.ReverseSoftLimitEnable = false;\n        \n        // Apply all configuration at once\n        m_motor.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "text",
      "title": "Configuration Persistence",
      "content": "Talon FX configuration is stored in the device's non-volatile memory. This means:<br><br><strong>Persistent Storage:</strong><br>- Configuration survives power cycles<br>- Configuration survives code deployments<br>- Settings remain until explicitly changed<br><br><strong>Configuration Priority:</strong><br>- Code configuration overrides stored configuration<br>- Last configuration applied takes effect<br>- Phoenix Tuner and code can both configure devices<br><br><strong>Best Practice:</strong> Always configure in code so your configuration is explicit and version-controlled. Don't rely solely on Phoenix Tuner configuration, as it may not be applied consistently."
    },
    {
      "type": "text",
      "title": "Configuration Best Practices",
      "content": "Following best practices ensures reliable and maintainable configuration:<br><br><strong>Code Organization:</strong><br>- Configure all devices in subsystem constructors<br>- Group related configuration together<br>- Use constants for configuration values<br>- Document non-obvious configuration choices<br><br><strong>Consistency:</strong><br>- Use same configuration for similar devices<br>- Follow team conventions for settings<br>- Document CAN ID assignments and configurations<br><br><strong>Testing:</strong><br>- Test configuration changes incrementally<br>- Verify behavior matches expectations<br>- Use Phoenix Tuner to monitor device status<br><br><strong>Version Control:</strong><br>- Commit configuration code to version control<br>- Document why certain settings were chosen<br>- Review configuration changes in code reviews"
    },
    {
      "type": "code",
      "title": "Configuration with Constants",
      "content": "package frc.robot.subsystems;\n\nimport com.ctre.phoenix6.hardware.TalonFX;\nimport com.ctre.phoenix6.configs.TalonFXConfiguration;\nimport com.ctre.phoenix6.signals.NeutralModeValue;\n\npublic class ConfigWithConstants {\n    // Configuration constants\n    private static final int CAN_ID = 1;\n    private static final double CURRENT_LIMIT = 40.0;\n    private static final double CURRENT_THRESHOLD = 45.0;\n    private static final double CURRENT_TIME = 0.5;\n    private static final double VOLTAGE_PEAK = 12.0;\n    \n    private final TalonFX m_motor = new TalonFX(CAN_ID);\n    \n    public ConfigWithConstants() {\n        TalonFXConfiguration config = new TalonFXConfiguration();\n        \n        // Use constants for configuration\n        config.MotorOutput.NeutralMode = NeutralModeValue.Brake;\n        \n        config.CurrentLimits.SupplyCurrentLimitEnable = true;\n        config.CurrentLimits.SupplyCurrentLimit = CURRENT_LIMIT;\n        config.CurrentLimits.SupplyCurrentLimitThreshold = CURRENT_THRESHOLD;\n        config.CurrentLimits.SupplyCurrentLimitThresholdTime = CURRENT_TIME;\n        \n        config.Voltage.PeakForwardVoltage = VOLTAGE_PEAK;\n        config.Voltage.PeakReverseVoltage = -VOLTAGE_PEAK;\n        \n        // Apply configuration\n        m_motor.getConfigurator().apply(config);\n    }\n}"
    },
    {
      "type": "rules-box",
      "title": "Configuration Checklist",
      "subtitle": "Essential configuration for each Talon FX:",
      "items": [
        "Configure motor inversion (if needed)",
        "Configure neutral mode (brake or coast)",
        "Set current limits (stator and supply)",
        "Enable voltage compensation",
        "Configure feedback sensor",
        "Reset encoder position (if using integrated encoder)",
        "Set sensor phase (if needed)",
        "Configure output limits (for safety)",
        "Test configuration with Phoenix Tuner"
      ]
    },
    {
      "type": "link-grid",
      "title": "Related Topics",
      "links": [
        { "label": "Talon FX Setup", "id": "talon-fx-setup" },
        { "label": "Talon FX PID Control", "id": "talon-fx-pid-control" },
        { "label": "Current Limiting", "id": "ctre-current-limiting" }
      ]
    }
  ]
}

